<?php
        //Create array from services row
        $servicesRow = array();
        foreach ($client->cars as $car) {
            foreach ($car->providedServices as $providedService) {
                $servicesRow[$providedService->id] = array();
                foreach ($providedService  as $key => $data) {
                    switch ($key)
                    {
                          case "car_id":
                              $servicesRow[$providedService->id]["regnum"] = $car->regnum;
                              break;
                          case "work_id":
                              foreach($carservices as $carservice) {
                                  if($data == $carservice->id) {
                                      $servicesRow[$providedService->id]["carservice"] = $carservice->carservice;
                                  }
                              }
                              break;
                          case "master_id":
                              foreach($employees as $employee) {
                                  if($data == $employee->id) {
                                      $servicesRow[$providedService->id]["master"] = $employee->fullname;
                                  }
                              }
                              break;
                          default:
                              $servicesRow[$providedService->id][$key] = $data;
                              break;
                    }
                }
            }
        }
?>
<div class="large-8 columns services-block">
    <table class="table-provided-services" align="center">
        <thead>
        <tr>
            <th>Номер</th>
            <th>Дата обслуживания</th>
            <th>Тип обслуживания</th>
            <th>Стоимость</th>
            <th>Пробег КМ</th>
            <th>Мастер</th>
            <th>Доп. Информация</th>
            <th>КМ Напоминание</th>
            <th>Дата Напоминание</th>
            <th class="remind-status-th">Статус напоминания</th>
        </tr>
        </thead>
        <tbody>
            <?php
                foreach($servicesRow as $row){
                    echo '<tr>';
                    echo '<td>'.$row["regnum"].'</td>';
                    echo '<td>'.$row["startdate"].'</td>';
                    echo '<td>'.$row["carservice"].'</td>';
                    echo '<td>'.$row["cost"].'</td>';
                    echo '<td>'.$row["milage"].'</td>';
                    echo '<td>'.$row["master"].'</td>';
                    echo '<td>'.$row["moreinfo"].'</td>';
                    echo '<td>';
                    $milageRemind = $row["remindkm"] + $row["milage"];
                    echo $milageRemind.'</td>';
                    if (time() - strtotime($row["reminddate"]) > 0){
                        $remindDateClass = "alert";
                    } else {
                        $remindDateClass = "success";
                    }
                    echo '<td class="date-'.$remindDateClass.'">';
                    echo $row["reminddate"].'</td>';
                    echo '<td class="remind-status">'.$row["remind"].'</td>';
                    echo '</tr>';
                }
            ?>
        </tbody>
    </table>
</div>
<div class="large-4 columns analytics-block">
    <div class="analytics-board">
        <div id="total-expenses">
            <?php
            $totalExpenses = 0;
            foreach($servicesRow as $row){
                $totalExpenses += $row["cost"];
            }
            echo '<h5>Total Expenses</h5><span id="total-cost" class="label radius success">'.$totalExpenses.' cум</span>';
            ?>
        </div>
        <div id="total-health"><h5>Total Health</h5><span id="car-health" class="label radius alert">65%</span></div>
        <div id="show-issues"><h5>Issues</h5><span id="issue-status" class="label radius success">No</span></div>
        <div id="days-in-maintenance"><h5>Days in Maintenance</h5><span id="days-in-maintenance" class="label radius secondary">10</span></div>
    </div>
    <div class="client-data">
        <ul class="client-info">
            <li><h5 class="label radius secondary"><?php echo $client->info->fullname;?></h5></li>
            <li><?php echo '<span class="label-info">Phone:</span> '.$client->info->contactphone;?></li>
            <li><?php echo '<span class="label-info">Email:</span> '.$client->info->contactemail;?></li>
            <li><?php echo '<span class="label-info">Signup date:</span> '.$client->info->regdate;?></li>
            <li><?php echo '<span class="label-info">Add info:</span> '.$client->info->moreinfo;?></li>
            <li><?php echo '<span class="label-info">Username:</span> '.$client->info->username;?></li>
        </ul>
    </div>
    <div class="car-data">
        <?php
        foreach ($client->cars as $car) {
            echo ' <ul class="car-info">';
            echo '<li><h5 class="label radius secondary">'.$car->model.'</h5></li>';
            echo '<li><span class="label-info">Reg. number:</span> '.$car->regnum.'</li>';
            echo '<li><span class="label-info">Year:</span> '.$car->year.'</li>';
            echo '<li><span class="label-info">First service date:</span> '.$car->regdate.'</li>';
            echo '<li><span class="label-info">Current millage:</span> '.$car->milage.' км</li>';
            echo '<li><span class="label-info">Milage/day:</span> '.$car->dailymilage.' км</li>';
            echo '<li><span class="label-info">Body number:</span> '.$car->bodynumber.'</li>';
            echo '<li><span class="label-info">Engine number:</span> '.$car->enginenumber.'</li>';
            echo '<li><span class="label-info">Add info:</span> '.$car->moreinfo.'</li>';
            echo '</ul>';
        }
        ?>
    </div>
</div>

