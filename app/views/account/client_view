<?php
        //Create array from services row
        foreach ($client->cars as $car) {
            foreach ($car->providedServices as $providedService) {
                foreach($carservices as $carservice) {
                    if($providedService->work_id == $carservice->id) {
                        $providedService->work_id = $carservice->carservice;
                    }
                }
                foreach($employees as $employee) {
                    if($providedService->master_id == $employee->id) {
                        $providedService->master_id  = $employee->fullname;
                    }
                }
            }
        }
?>
<div class="large-8 columns services-block">
    <table class="table-provided-services" align="center">
        <thead>
        <tr>
            <th>Номер</th>
            <th>Дата обслуживания</th>
            <th>Тип обслуживания</th>
            <th>Стоимость</th>
            <th>Пробег КМ</th>
            <th>Мастер</th>
            <th>Доп. Информация</th>
            <th>КМ Напоминание</th>
            <th>Дата Напоминание</th>
            <th class="remind-status-th">Статус напоминания</th>
        </tr>
        </thead>
        <tbody>
            <?php
            foreach ($client->cars as $car) {
                foreach ($car->providedServices as $providedService) {
                    echo '<tr>';
                    echo '<td>'.$car->regnum.'</td>';
                    echo '<td>'.$providedService->startdate.'</td>';
                    echo '<td>'.$providedService->work_id.'</td>';
                    echo '<td>'.$providedService->cost.'</td>';
                    echo '<td>'.$providedService->milage.'</td>';
                    echo '<td>'.$providedService->master_id.'</td>';
                    echo '<td>'.$providedService->moreinfo.'</td>';
                    echo '<td>';
                    $milageRemind = $providedService->remindkm + $providedService->milage;
                    echo $milageRemind.'</td>';
                    if (time() - strtotime($providedService->reminddate) > 0){
                        $remindDateClass = "alert";
                    } else {
                        $remindDateClass = "success";
                    }
                    echo '<td class="date-'.$remindDateClass.'">';
                    echo $providedService->reminddate.'</td>';
                    echo '<td class="remind-status">'.$providedService->remind.'</td>';
                    echo '</tr>';
                }
            }
            ?>
        </tbody>
    </table>
</div>
<div class="large-4 columns analytics-block">
    <div class="analytics-board">
        <?php
        foreach ($client->cars as $car) {
            //Create div block per car
            echo '<div class="analytic-data">';
            $car->totalExpenses = 0;
            foreach ($car->providedServices as $providedService) {
                $car->totalExpenses += $providedService->cost;
            }
            echo '<h5 class="label radius secondary car-regnum">'.$car->regnum.'</h5>';
            echo '<div class="total-expenses">';
            echo '<h5>Total Expenses</h5><span id="total-cost" class="label radius success">'.$car->totalExpenses.' cум</span>';
        ?>
            </div>
        <div class="total-health"><h5>Total Health</h5><span id="car-health" class="label radius">75%</span></div>
        <div class="show-issues"><h5>Issues</h5><span id="issue-status" class="label radius alert">2</span></div>
        <div class="days-in-maintenance"><h5>Days in Maintenance</h5><span id="days-in-maintenance" class="label radius secondary">10</span></div>
        <?php
            //Close tag for per car block
            echo '</div>';
        } ?>
    </div>
    <div class="client-data">
        <ul class="client-info">
            <li><h5 class="label radius secondary"><?php echo $client->info->fullname;?></h5></li>
            <li><?php
                $labelInfoClass = 'label-info';
                echo '<span class="'.$labelInfoClass.'">Phone:</span>'.$client->info->contactphone;?></li>
            <li><?php echo '<span class="'.$labelInfoClass.'">Email:</span>'.$client->info->contactemail;?></li>
            <li><?php echo '<span class="'.$labelInfoClass.'">Signup date:</span>'.$client->info->regdate;?></li>
            <li><?php echo '<span class="'.$labelInfoClass.'">Add info:</span>'.$client->info->moreinfo;?></li>
            <li><?php echo '<span class="'.$labelInfoClass.'">Username:</span>'.$client->info->username;?></li>
        </ul>
    </div>
    <div class="car-data">
        <?php
        //Same header car info label class
        foreach ($client->cars as $car) {
            echo ' <ul class="car-info" data-car-id="'.$car->id.'">';
            echo '<li><h5 class="label radius secondary">'.$car->model.'</h5></li>';
            echo '<li><span class="'.$labelInfoClass.'">Reg. number:</span>'.$car->regnum.'</li>';
            echo '<li><span class="'.$labelInfoClass.'">Year:</span>'.$car->year.'</li>';
            echo '<li><span class="'.$labelInfoClass.'">First service date:</span>'.$car->regdate.'</li>';
            echo '<li><span class="'.$labelInfoClass.'">Current KM:</span><span class="milage" onClick="updateCarData($(this));">'.$car->milage.'</span></li>';
            echo '<li><span class="'.$labelInfoClass.'">Milage KM/day:</span><span class="dailymilage">'.$car->dailymilage.'</span></li>';
            echo '<li><span class="'.$labelInfoClass.'">Body number:</span>'.$car->bodynumber.'</li>';
            echo '<li><span class="'.$labelInfoClass.'">Engine number:</span>'.$car->enginenumber.'</li>';
            echo '<li><span class="'.$labelInfoClass.'">Add info:</span>'.$car->moreinfo.'</li>';
            echo '</ul>';
        }
        ?>
    </div>
</div>

